# 《微习惯实验室》微信小程序
完整产品需求文档（PRD）—— 原生小程序 + 微信云开发

版本号：V1.2
日期：2025-12-26
技术方案：**原生微信小程序 + 微信云开发（CloudBase）**
目标：1 个月内完成「极简 MVP 版」开发、测试并上线内测。

---

## 一、项目概述

### 1.1 产品简介

- 产品名（暂定）：微习惯实验室
- 英文名（可选）：Micro Habits Lab
- 产品形态：微信小程序（Android / iOS / 微信内使用）
- 技术栈：
  - 前端：原生微信小程序（WXML / WXSS / JS）
  - 后端：微信云开发（云函数 + 云数据库 + 云调用）

### 1.2 产品定位

一款基于“行为科学”的**微习惯养成工具**，通过：

- 微习惯（Micro Habits）：把行为缩小到 30 秒内可完成；
- 触发器（Trigger）：用“刷牙后 / 下班后 / 睡前”等固定事件作为启动信号；
- 21 天实验周期（Experiment）：每个习惯视为一个 21 天的小实验，周期结束复盘与调整；

帮助用户**逐步、低压力地改善生活方式**，不同于传统“只看连续天数”的打卡 App。

### 1.3 目标用户

1. 25–40 岁上班族
   - 想改变：早睡、喝水、运动、少刷手机等；
   - 有一定自我提升意识，但容易“计划很大、坚持很短”。

2. 学生（高中/大学）
   - 想养成学习、阅读、背单词、写作习惯；
   - 常见问题：三分钟热度、拖延。

3. 轻度健身/减脂人群
   - 想运动，但不想一开始就进行高强度训练；
   - 更愿意从“小动作”开始。

### 1.4 使用场景举例

- 早晨起床或睡前：打开小程序查看今日需要完成的 2–5 个微习惯；
- 日常生活中，当触发器发生时：
  - 如刷完牙、下班回家、吃完饭、准备睡觉……
  - 用户完成对应微习惯（如喝一口水、深呼吸 3 次），然后点一下“打卡”；
- 21 天后：
  - 系统弹出“实验结束”的简报；
  - 用户选择：继续下一轮 / 改小一点 / 先暂停。

---

## 二、版本范围与目标

### 2.1 V1.2（MVP）业务目标

1. 用户可通过微信登录并初始化账户；
2. 用户可以：
   - 从系统预设微习惯库中选择习惯；
   - 创建自己的微习惯（行为 + 触发器 + 频次）；
3. 首页展示“今日习惯”列表，支持一键打卡；
4. 系统自动按 21 天记录习惯实验周期，提供基础数据图和模板化建议；
5. 实现会员功能：
   - 会员价：6.6 元 / 月；
   - 免费用户限制：最多 3 个习惯、部分数据受限；
   - 会员解锁：更多习惯、完整数据与报告。

### 2.2 不在本期范围（留作后续版本）

- 搭子 / 好友互相监督和打气；
- 社区、动态、帖子等社交功能；
- 复杂游戏化（等级、连续奖励、成长树等）；
- 多语言、多主题深度定制；
- 基于 AI 的个性化建议（V1 只用模板与规则生成文本）。

---

## 三、功能需求

### 3.1 用户系统

#### 3.1.1 微信登录 & 云开发初始化

- 小程序启动时初始化云开发环境：

  ```js
  wx.cloud.init({
    env: '你的云开发环境ID',
    traceUser: true
  });
  ```

- 使用微信一键登录（`wx.login` + 云函数获取 openid，或在云函数中直接使用 `wx-server-sdk` 获取 `OPENID`）；

- 第一次登录：
  - 在 `users` 集合中创建用户记录；
  - 初始化：`member_status = 0`（非会员）、`member_expire_time = null`。

- 后续登录：
  - 更新 `last_login_time`；
  - 返回用户信息（包含会员状态）。

#### 3.1.2 用户数据结构（集合：`users`）

```json
{
  "_id": "自动生成",
  "openid": "用户的微信OPENID",
  "register_time": "2025-12-26T10:00:00Z",
  "last_login_time": "2025-12-26T10:00:00Z",
  "member_status": 0,            // 0=普通用户，1=会员
  "member_expire_time": "2026-01-26T10:00:00Z"  // 可为空
}
```

---

### 3.2 系统预设微习惯库（HabitTemplate）

> 用于降低用户决策成本，用户可直接“拿来用”。

#### 3.2.1 功能说明

- 用户可在“习惯库”中浏览首发 20 条微习惯；
- 支持按类别筛选：全部 / 健康 / 学习 / 情绪 / 效率；
- 点击“添加”后，将该模板复制为一个 `user_habits` 记录。

#### 3.2.2 数据结构（集合：`habit_templates`）

```json
{
  "_id": "模板ID",
  "name": "每天早上刷牙后喝 1 大口水",
  "category": "health",            // health / study / emotion / efficiency
  "default_trigger": "刷牙后",
  "description": "补充夜间流失的水分，帮助身体“启动新的一天”。",
  "is_active": true
}
```

> 初始化数据：导入你已有的“微习惯库首发 20 条清单”。

---

### 3.3 用户习惯（UserHabit）

#### 3.3.1 用户创建习惯方式

- 来源一：从预设习惯库选择，稍作确认；
- 来源二：完全自定义（简单 2 步表单）：

  1. 行为描述：
     - 输入框，最长 30 字；
     - 示例提示：“30 秒内能完成的小动作，如：喝一口水”；
  2. 触发器 + 频次：
     - 预设触发器列表：刷牙后 / 上班路上 / 午饭后 / 下班到家后 / 睡前 / 其他；
     - 每天执行次数（1 / 2 次，默认 1 次）。

#### 3.3.2 用户习惯数据结构（集合：`user_habits`）

```json
{
  "_id": "自动生成",
  "user_id": "openid",                       // or users._id
  "template_id": "habit_templates._id 或 null",
  "name": "刷牙后喝一口水",
  "trigger": "刷牙后",
  "target_times_per_day": 1,
  "start_date": "2025-12-26",               // YYYY-MM-DD
  "cycle_days": 21,
  "status": "in_progress",                  // in_progress / finished
  "created_at": "2025-12-26T10:00:00Z",
  "updated_at": "2025-12-26T10:00:00Z"
}
```

#### 3.3.3 业务规则

- 每个习惯默认一个 21 天实验周期：
  - `end_date = start_date + (cycle_days - 1)`；
- 免费用户最多同时拥有的「进行中(in_progress)」习惯数 = 3；
- 会员用户的进行中习惯上限可配置（例如 20）。

---

### 3.4 打卡记录（HabitLog）

#### 3.4.1 功能说明

- 用户在「今日习惯」页点击某习惯的打卡按钮；
- 每次点击：
  - 当日该习惯的 `times` + 1（不超过 `target_times_per_day`）；
- 用于统计完成情况与生成报告。

#### 3.4.2 数据结构（集合：`habit_logs`）

```json
{
  "_id": "自动生成",
  "user_id": "openid",
  "user_habit_id": "user_habits._id",
  "date": "2025-12-26",        // 当天日期 YYYY-MM-DD
  "times": 1,                  // 当日打卡次数
  "created_at": "2025-12-26T10:05:00Z",
  "updated_at": "2025-12-26T10:05:00Z"
}
```

> 统计时，以 `times >= 1` 视为当天完成。

---

### 3.5 今日习惯页（Home）

#### 3.5.1 功能目标

- 展示所有「进行中」且处于当前周期内的习惯；
- 每个习惯显示今日目标与已完成次数；
- 支持一键打卡。

#### 3.5.2 展示规则

- 从 `user_habits` 中筛选：
  - `user_id = openid`
  - `status = "in_progress"`
  - 当前日期在 `[start_date, end_date]` 范围内；
- 对每个 habit 查询 `habit_logs` 中当日记录，得到 `today_times`；
- 返回字段：
  - `name, trigger, target_times_per_day, today_times`。

#### 3.5.3 UI 要求（简述）

- 顶部：日期 + 鼓励语；
- 中部：卡片列表，每个：
  - 名称
  - 触发器标签【触发：XX】
  - 今日进度（0/1, 1/1 等）
  - 打卡按钮
- 底部：新建微习惯按钮。

#### 3.5.4 打卡逻辑（云函数：`logHabit`）

- 输入参数：`user_habit_id`；
- 云函数步骤：
  1. 从 `context.OPENID` 获取 `user_id`；
  2. 获取今天日期 `today`；
  3. 查 `habit_logs` 中是否已存在 `user_id + user_habit_id + date=today`；
     - 无：插入 `times = 1`；
     - 有：`times = min(times + 1, target_times_per_day)`；
  4. 返回更新后的 `times`；
- 前端处理：
  - 本地先做乐观更新；
  - 若云函数失败，提示“网络异常，已恢复原状态”。

---

### 3.6 习惯实验周期 & 结束复盘

#### 3.6.1 周期结束判断

- 每次打开应用或进入“今日习惯”/“数据”页时：
  - 云函数检查所有 `user_habits`：
    - 若 `today > end_date` 且 `status = in_progress`，则该习惯实验周期结束；
  - 对每个结束的习惯，在前端弹出“21 天实验结束”弹窗。

#### 3.6.2 弹窗内容与操作

- 内容示例：

  - 标题：`21 天实验结束：{习惯名称}`
  - 文本：
    - “在这 21 天里，你在 {完成天数}/21 天完成了这个微习惯，完成率 {X%}。”

- 三个按钮：

  1. 「继续下一轮 21 天」
     - 行为：
       - 将 `start_date` 更新为今天；
       - `cycle_days` 保持 21；
       - `status` 仍 `in_progress`；
       - 历史 `habit_logs` 保留（用于长期统计）。
  2. 「太难了，改小一点」
     - 行为：
       - 跳转到习惯编辑页（仅允许编辑 `name` 与 `trigger`）；
       - 保存后，重开一个新周期（`start_date = 今天`）。
  3. 「先暂停这个习惯」
     - 行为：
       - 将 `status` 更新为 `finished`；
       - 不再显示在“今日习惯”中。

---

### 3.7 数据与报告（Tab：数据 & 我）

#### 3.7.1 数据概览

- 统计维度：
  1. 当前进行中习惯数：
     - 条件：`user_id = openid AND status = in_progress`；
  2. 已完成实验次数：
     - 条件：`user_id = openid AND status = finished`（或统计结束周期数）；
  3. 最长连续坚持天数：
     - 计算方式可简化：找单个习惯在最近周期内的最大连续完成天数。

- 在页面顶部展示为 3 个数字卡片。

#### 3.7.2 单习惯简易图表

- 在“数据 & 我”页中，列出用户的所有习惯：
  - 名称；
  - 最近 7 天完成情况（7 个点的完成/未完成）；
- 点击进入「习惯详情」页。

#### 3.7.3 习惯详情页报告

- 内容包含：
  - 基础信息：名称、触发器、起止日期、状态；
  - 完成情况：
    - 最近 21 天的完成日历（小格子图）；
    - 完成天数、完成率（百分比）；
  - 模板建议（简单规则）：
    - 完成率 > 80% → 建议轻微升级难度；
    - 50–80% → 建议优化时间或环境；
    - < 50% → 建议把动作再拆小。

- 免费用户限制：
  - 仅显示最近 7 天图表；
  - 21 天完整图表区域灰度 + 提示开通会员解锁。

---

### 3.8 会员功能（6.6 元 / 月）

#### 3.8.1 产品形态

- 名称：微习惯会员（月度）
- 价格：6.6 元 / 月
- V1 只开放月度，季卡/年卡可后续增加。

#### 3.8.2 免费 vs 会员差异

**免费用户：**

- 同时进行中的习惯上限：3 个；
- 预设习惯库只能使用部分模板（如每类各 1–2 条）；
- 数据可视化：
  - 仅最近 7 天图；
  - 不显示完整 21 天日历图；
- 报告：
  - 显示简单完成率 & 一句通用建议。

**会员用户：**

- 同时进行中的习惯上限：20 个（或通过配置）；
- 解锁全部预设习惯模板；
- 数据可视化：
  - 可查看完整 21 天历史图；
- 报告：
  - 展示完整 21 天完成情况 + 针对完成率区间的详细建议；
  - 可填写一小段自己的“实验备注”（文本存进 `user_habits` 或单独集合）。

#### 3.8.3 会员开通与校验逻辑

- 支付方式：微信支付（小程序内虚拟会员）；
- 开通流程：
  1. 用户在会员介绍页点击“6.6 元/月 开通会员”；
  2. 调起小程序支付；
  3. 支付成功后：
     - 在云函数中更新 `users.member_status = 1`；
     - `member_expire_time = 当前时间 + 30天`；
- 权限校验：
  - 每次进入关键页面（新建习惯、查看报告等），调用云函数或从本地缓存刷新用户状态；
  - 若当前时间 > `member_expire_time`，自动降为普通用户。

#### 3.8.4 会员引导触发点

1. 用户尝试创建第 4 个「进行中」习惯时：
   - 弹窗：说明免费版最多 3 个习惯，邀请开通会员管理更多实验；
2. 用户在习惯详情页点击“查看完整 21 天图表”：
   - 若非会员 → 弹会员介绍；
3. 在“数据 & 我”页中，展示会员模块（卡片），长驻入口。

---

### 3.9 设置与其它

#### 3.9.1 设置页

- 隐私政策（静态文本）；
- 关于我们（产品介绍 + 版本号）；
- 意见反馈（可使用邮箱 / 微信号 / 简单表单）。

#### 3.9.2 多端适配

- 主要适配：主流安卓和 iOS 机型；
- 尽量使用相对布局，避免内容被底部安全区遮挡。

---

## 四、UI/UX 概要（供设计 & AI 使用）

> 这里只列重点风格与布局要求，详细交互已在上文分页面说明。

### 4.1 整体风格

- 关键词：简洁、干净、轻松、疗愈；
- 主色：建议浅绿色或浅蓝色（表示“健康/平静”）；
- 背景：大部分区域为浅灰或白色；
- 字体：微信默认字体，适度加粗标题。

### 4.2 通用组件

- 顶部导航：使用小程序默认导航栏或自定义轻简导航；
- 卡片：圆角 12px 左右，投影较弱；
- 按钮：圆角按钮，禁用态颜色变浅。

---

## 五、基于微信云开发的技术设计

### 5.1 数据库集合一览

- `users`：用户信息与会员状态；
- `habit_templates`：预设微习惯模板；
- `user_habits`：用户创建的习惯；
- `habit_logs`：习惯每日打卡记录。

### 5.2 云函数一览（建议）

- `initUser`：初始化/获取用户信息；
- `getTodayHabits`：获取今日习惯列表及今日打卡情况；
- `createHabit`：创建习惯（预设或自定义），含免费/会员上限校验；
- `logHabit`：打卡；
- `getStats`：获取统计数据与图表数据；
- `updateHabitStatus`：检查并更新习惯实验周期状态（可合并入其他函数）；
- `membership`：处理会员开通/续费、状态更新等。

> 具体实现可由 AI/开发根据此结构生成 Node.js 云函数代码。

---

## 六、非功能需求

### 6.1 性能

- 初期用户量较小，云开发默认性能足够；
- 关键页面：
  - 今日习惯页：首屏加载控制在 3 秒内；
  - 数据页：可分步加载（先显示统计数字，再加载图表）。

### 6.2 稳定性与容错

- 网络异常时打卡：
  - 应提示用户“网络异常，稍后再试”；
  - 避免重复提交，多次点击应临时禁用按钮 1 秒；
- 云函数错误：
  - 返回统一格式 `{ code, msg, data }`；
  - code 非 0 时，前端 toast 显示 msg。

### 6.3 安全与隐私

- 不收集敏感个人信息（如手机号、身份信息），仅使用 openid；
- 所有数据存储在微信云开发数据库；
- 小程序内提供明确的《隐私政策》说明数据用途与保存方式。

---

## 七、项目实施建议（时间节奏）

> 按“1 个人主导 + AI 工具辅助 + 1 个月周期”估算。

- 第 1 周：
  - 确认需求（即本 PRD）；
  - 搭建小程序项目（原生）与云开发环境；
  - 完成 3 个主页面的静态 UI（Home / Habits / Stats）。

- 第 2 周：
  - 实现云函数：`initUser`、`getTodayHabits`、`createHabit`、`logHabit`；
  - 打通“创建习惯 → 今日习惯 → 打卡 → 数据写入”。

- 第 3 周：
  - 实现统计与报告：`getStats`、习惯详情页图表；
  - 接入微信支付与会员逻辑（只做月度）。

- 第 4 周：
  - 内部自测、修 Bug、优化交互文案；
  - 补充隐私政策与上架文案；
  - 提交微信审核、灰度上线。

---

## 八、如何配合 AI 工具使用本需求文档

### 8.1 作为“项目说明”上下文

- 在 Cursor / ChatGPT / Claude 等工具中：
  - 将本 `.md` 文档全部粘贴到一个长对话中；
  - 然后按模块发指令，比如：
    - “根据上述 PRD，帮我生成小程序基础目录结构和 app.json 配置”；
    - “根据上述‘云函数一览’，实现 `initUser` 云函数代码（Node.js）”；
    - “根据‘今日习惯页’说明，生成对应的 WXML/WXSS/JS 文件骨架”。
